_BASE_: "../Base-RCNN-C4.yaml"
DATASETS:
  SOURCE_DOMAIN:
    TRAIN: ("sim10k_train",) # sim10k2city_train == use Cycle GAN data 
  TARGET_DOMAIN:
    TRAIN: ("cityscapes-car_train",)
  TRAIN: ("sim10k_train",)
  TEST: ("cityscapes-car2_val",)
MODEL:
  META_ARCHITECTURE: "SAPRCNN"
  BACKBONE:
    NAME: "build_resnet_backbone_"
    FREEZE_AT: 1
  WEIGHTS: "detectron2://ImageNetPretrained/MSRA/R-50.pkl"
  KEYPOINT_ON: False
  MASK_ON: False
  DOMAIN_ADAPTATION_ON: True
  ROI_HEADS:
    NUM_CLASSES: 1
  DA_HEAD:
    NAME: "SAPNet" # use MSCAM or iAFF
    IN_FEATURE: "res4"
    IN_CHANNELS: 1024
    NUM_ANCHOR_IN_IMG: 15
    EMBEDDING_KERNEL_SIZE: 3
    EMBEDDING_NORM: True
    EMBEDDING_DROPOUT: True
    FUNC_NAME: "cross_entropy"
    POOL_TYPE: 'avg'
    LOSS_WEIGHT: 0.1
    # use MEDM Loss
    RPN_MEDM_ON: False 
    TARGET_ENT_LOSS_WEIGHT: 0.8
    TARGET_DIV_LOSS_WEIGHT: -0.3
    # use MIC Loss #
    MIC_ON: True
    MIC_RPN_CLS_WEIGHT: 1.0
    MIC_RPN_LOC_WEIGHT: 1.0
    MIC_CLS_WEIGHT: 1.0
    MIC_BOX_REG_WEIGHT: 1.0
    MASKING_BLOCK_SIZE: 32
    MASKING_RATIO: 0.5
    MASK_COLOR_JITTER_S: 0.2
    MASK_COLOR_JITTER_P: 0.2
    MASK_BLUR: False
    PIXEL_MEAN: [0.485, 0.456, 0.406]
    PIXEL_STD: [0.229, 0.224, 0.225]
    TEACHER_ALPHA: 0.9
    PSEUDO_LABEL_THRESHOLD: 0.8  
    WINDOW_STRIDES: [2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2]
    WINDOW_SIZES: [3, 6, 9, 12, 15, 18, 21, 24, 27, 30, 33, 35, 37]
  PROPOSAL_GENERATOR:
    NAME: "SAPRPN"
INPUT:
  MIN_SIZE_TRAIN: (800, 832, 864, 896, 928, 960, 992, 1024)
  #MIN_SIZE_TRAIN: (800,)
  MIN_SIZE_TRAIN_SAMPLING: "choice"
  MIN_SIZE_TEST: 1024
  MAX_SIZE_TRAIN: 2048
  MAX_SIZE_TEST: 2048
SOLVER:
  NAME: "adam"
  IMS_PER_BATCH: 2 # batch size
  STEPS: (8000,)
  BASE_LR: 0.00001
  MAX_ITER: 20000  #14000
  CHECKPOINT_PERIOD: 200
  WARMUP_ITERS: 500
  WARMUP_FACTOR: 0.002
TEST:
  EVAL_PERIOD: 200
VIS_PERIOD: 1000
SEED: 42
